<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible English Fun - LOTW Lesson A1-17</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            background-attachment: fixed;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #333;
            text-align: center;
        }
        
        header {
            background: linear-gradient(135deg, #3a7bd5, #00d2ff);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }
        
        header h2 {
            font-size: 1.5rem;
            font-weight: normal;
        }
        
        .game-container {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin: 30px auto;
            max-width: 900px;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            max-width: 950px;
            margin: 0 auto 40px;
            padding: 20px;
        }
        
        .menu-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
        }
        
        .game-btn {
            background: linear-gradient(135deg, #56ab2f, #a8e063);
            color: white;
            border: none;
            padding: 25px 35px;
            border-radius: 15px;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
            flex: 1;
            min-width: 280px;
            max-width: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 140px;
            position: relative;
            overflow: hidden;
        }
        
        .game-btn:before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            pointer-events: none;
        }
        
        .game-btn:hover {
            background: linear-gradient(135deg, #a8e063, #56ab2f);
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }
        
        .game-btn:hover:before {
            top: 0;
            left: 0;
        }
        
        .game-btn i {
            font-size: 40px;
            margin-bottom: 15px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .game-title {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2.2rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .game-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #34495e;
            line-height: 1.6;
        }
        
        .preposition-option {
            background: linear-gradient(to bottom, #e6f2ff, #cce0ff);
            padding: 12px 20px;
            margin: 8px;
            border-radius: 10px;
            display: inline-block;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .preposition-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: #3a7bd5;
        }
        
        .commandment-card {
            background: linear-gradient(to bottom, #fffacd, #fff176);
            padding: 18px;
            margin: 12px;
            border-radius: 12px;
            cursor: move;
            display: inline-block;
            width: 180px;
            text-align: center;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .commandment-card:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .commandment-card.correct-placement {
            border-color: #4CAF50;
            background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
        }
        
        .commandment-card.incorrect-placement {
            border-color: #f44336;
            background: linear-gradient(to bottom, #ffebee, #ffcdd2);
        }
        
        .basket {
            background: linear-gradient(to bottom, #98fb98, #76c776);
            padding: 25px;
            margin: 15px;
            border-radius: 15px;
            min-height: 150px;
            width: 42%;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid #2e7d32;
        }
        
        .basket h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #1b5e20;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .vocab-tile {
            width: 130px;
            height: 130px;
            background: radial-gradient(circle, #ffd700, #ffa000);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 15px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 24px;
            color: #333;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            border: 3px solid #ffa000;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .vocab-tile:hover {
            transform: scale(1.08) rotate(3deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .feedback {
            font-size: 24px;
            margin: 20px 0;
            min-height: 40px;
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .correct {
            color: #2e7d32;
            background-color: #e8f5e9;
            border: 2px solid #4CAF50;
        }
        
        .incorrect {
            color: #c62828;
            background-color: #ffebee;
            border: 2px solid #f44336;
        }
        
        .missing-word {
            display: inline-block;
            width: auto;
            min-width: 110px;
            height: auto;
            min-height: 40px;
            border-bottom: 3px solid #3a7bd5;
            margin: 0 8px;
            padding: 0 12px;
            vertical-align: middle;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            color: #333;
            font-size: 18px;
            border-radius: 5px;
            background: #f0f8ff;
            transition: all 0.3s ease;
        }
        
        .missing-word.correct-drop {
            color: #2e7d32;
            border-bottom: 3px solid #4CAF50;
            background: #e8f5e9;
        }
        
        .missing-word.incorrect-drop {
            color: #c62828;
            border-bottom: 3px solid #f44336;
            background: #ffebee;
        }
        
        .nav-btn {
            background: linear-gradient(to bottom, #3a7bd5, #00d2ff);
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 12px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            min-width: 150px;
        }
        
        .nav-btn:hover {
            background: linear-gradient(to bottom, #00d2ff, #3a7bd5);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .nav-btn i {
            margin-right: 8px;
        }
        
        #commandmentOptionsContainer {
            margin-top: 25px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
            min-height: 80px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        #prepositionSentences p {
            margin-bottom: 20px;
            font-size: 20px;
            line-height: 1.8;
        }
        
        #audioControls {
            margin: 30px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        #volumeControl {
            width: 150px;
            height: 10px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #3a7bd5, #00d2ff);
            border-radius: 5px;
            outline: none;
        }
        
        #volumeControl::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 2px solid #3a7bd5;
        }
        
        .audio-nav-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .word-info {
            font-weight: bold;
            margin: 20px 0;
            font-size: 24px;
            min-height: 1.5em;
            color: #3a7bd5;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            padding: 10px;
            background: #e3f2fd;
            border-radius: 10px;
            display: inline-block;
        }
        
        .progress-container {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            background: #e0e0e0;
            border-radius: 10px;
            height: 15px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .game-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            min-width: 120px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            .menu-row {
                flex-direction: column;
                gap: 20px;
            }
            
            .game-btn {
                min-width: auto;
                width: 100%;
                height: 120px;
                padding: 20px;
                font-size: 20px;
            }
            
            .basket {
                width: 100%;
                margin: 10px 0;
            }
            
            .vocab-tile {
                width: 120px;
                height: 120px;
                margin: 10px;
                font-size: 20px;
            }
            
            .nav-btn {
                padding: 12px 20px;
                font-size: 16px;
                min-width: 130px;
            }
            
            .audio-nav-container {
                gap: 10px;
            }
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .game-score {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #3a7bd5, #00d2ff);
            color: white;
            padding: 10px 25px;
            border-radius: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .floating-bible {
            position: absolute;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(0) translateX(0) rotate(0deg); }
            25% { transform: translateY(-20px) translateX(20px) rotate(5deg); }
            50% { transform: translateY(0) translateX(40px) rotate(0deg); }
            75% { transform: translateY(20px) translateX(20px) rotate(-5deg); }
            100% { transform: translateY(0) translateX(0) rotate(0deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Floating Bible verses -->
    <div class="floating-bible" style="top: 5%; left: 5%;">John 3:16</div>
    <div class="floating-bible" style="top: 10%; left: 90%;">Psalm 23:1</div>
    <div class="floating-bible" style="top: 85%; left: 15%;">Proverbs 3:5</div>
    <div class="floating-bible" style="top: 90%; left: 80%;">Matthew 5:16</div>
    <div class="floating-bible" style="top: 20%; left: 20%;">Philippians 4:13</div>
    
    <header>
        <h1>Bible English Fun</h1>
        <h2>LOTW Lesson #A1-17</h2>
    </header>

    <div id="menu">
        <div class="menu-row">
            <button class="game-btn" onclick="showGame('prepositions')">
                <i class="fas fa-map-marker-alt"></i>
                Where Is It?<br>(Prepositions)
            </button>
            <button class="game-btn" onclick="showGame('commandments')">
                <i class="fas fa-tablets"></i>
                Ten Commandments Sort
            </button>
        </div>
        <div class="menu-row">
            <button class="game-btn" onclick="showGame('vocabulary')">
                <i class="fas fa-volume-up"></i>
                Listen & Tap Vocabulary
            </button>
        </div>
    </div>

    <!-- Game 1: Prepositions -->
    <div id="prepositions" class="game-container">
        <div class="game-header">
            <h2 class="game-title">Where Is It?</h2>
            <div class="game-score">Score: <span id="prepScore">0</span>/10</div>
        </div>
        <p class="game-description">Drag the correct preposition to complete each sentence!</p>
        
        <div style="margin: 25px;" id="prepositionSentences">
            <p>1. The dog is <span class="missing-word" id="prepBlank1" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="beside"></span> the man.</p>
            <p>2. The food is <span class="missing-word" id="prepBlank2" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="on"></span> the blanket.</p>
            <p>3. The tree is <span class="missing-word" id="prepBlank3" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="behind"></span> the woman.</p>
            <p>4. The bird is singing <span class="missing-word" id="prepBlank4" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="in"></span> its cage.</p>
            <p>5. The chandelier hangs <span class="missing-word" id="prepBlank5" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="above"></span> the dining table.</p>
            <p>6. The cat is sleeping <span class="missing-word" id="prepBlank6" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="under"></span> the chair.</p>
            <p>7. The flowers are planted <span class="missing-word" id="prepBlank7" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="near"></span> the fence.</p>
            <p>8. The path goes <span class="missing-word" id="prepBlank8" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="through"></span> the forest.</p>
            <p>9. She stood <span class="missing-word" id="prepBlank9" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="among"></span> the crowd.</p>
            <p>10. The bridge goes <span class="missing-word" id="prepBlank10" ondrop="dropPreposition(event)" ondragover="allowDrop(event)" data-correct="over"></span> the river.</p>
        </div>
        
        <div style="margin-top: 25px; padding: 15px; background: #f0f8ff; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);" id="prepositionOptionsContainer">
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="on">on</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="beside">beside</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="behind">behind</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="in">in</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="above">above</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="under">under</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="near">near</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="through">through</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="among">among</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="over">over</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="between">between</div>
            <div class="preposition-option" draggable="true" ondragstart="drag(event)" id="far">far</div>
        </div>
        
        <div class="feedback" id="prepFeedback"></div>
        <button class="nav-btn" onclick="checkPrepositions()"><i class="fas fa-check-circle"></i> Check Answers</button>
        <button class="nav-btn" onclick="resetPrepositions()"><i class="fas fa-redo"></i> Reset</button>
        <button class="nav-btn" onclick="hideAllGames()"><i class="fas fa-home"></i> Back to Menu</button>
    </div>

    <!-- Game 2: Commandments Sort -->
    <div id="commandments" class="game-container">
        <div class="game-header">
            <h2 class="game-title">Ten Commandments Sort</h2>
            <div class="game-score">Score: <span id="cmdScore">0</span>/10</div>
        </div>
        <p class="game-description">Drag each commandment to the correct basket!</p>
        
        <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
            <div class="basket" id="loveGod" ondrop="drop(event)" ondragover="allowDrop(event)">
                <h3>Love God</h3>
            </div>
            <div class="basket" id="lovePeople" ondrop="drop(event)" ondragover="allowDrop(event)">
                <h3>Love People</h3>
            </div>
        </div>
        
        <div id="commandmentOptionsContainer">
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd1" data-category="loveGod">Do not have other gods</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd2" data-category="loveGod">Do not make idols</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd3" data-category="loveGod">Do not misuse God's name</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd4" data-category="loveGod">Keep Sabbath holy</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd5" data-category="lovePeople">Love your parents</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd6" data-category="lovePeople">Do not murder</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd7" data-category="lovePeople">Do not do sex sins</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd8" data-category="lovePeople">Do not steal</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd9" data-category="lovePeople">Do not tell lies</div>
            <div class="commandment-card" draggable="true" ondragstart="drag(event)" id="cmd10" data-category="lovePeople">Do not covet</div>
        </div>
        
        <div class="feedback" id="cmdFeedback"></div>
        <button class="nav-btn" onclick="checkCommandments()"><i class="fas fa-check-circle"></i> Check Answers</button>
        <button class="nav-btn" onclick="resetCommandments()"><i class="fas fa-redo"></i> Reset</button>
        <button class="nav-btn" onclick="hideAllGames()"><i class="fas fa-home"></i> Back to Menu</button>
    </div>

    <!-- Game 3: Vocabulary -->
    <div id="vocabulary" class="game-container">
        <div class="game-header">
            <h2 class="game-title">Listen & Tap Vocabulary</h2>
            <div class="game-score">Score: <span id="vocabScore">0</span>/6</div>
        </div>
        <p class="game-description">Listen to the word, then tap the matching tile!</p>
        
        <div id="audioControls">
            <div class="word-info" id="currentWordInfo">Word 1 of 6: LAWS</div>
            
            <div class="audio-nav-container">
                <button class="nav-btn" onclick="playPreviousWord()">
                    <i class="fas fa-step-backward"></i> Previous
                </button>
                <button class="nav-btn" onclick="playCurrentWord()">
                    <i class="fas fa-play"></i> Play
                </button>
                <button class="nav-btn" onclick="playCurrentWord(true)">
                    <i class="fas fa-redo"></i> Repeat
                </button>
                <button class="nav-btn" onclick="playNextWord()">
                    <i class="fas fa-step-forward"></i> Next
                </button>
            </div>
            
            <div style="display: flex; align-items: center; gap: 10px; justify-content: center; margin-top: 15px;">
                <i class="fas fa-volume-up fa-lg"></i>
                <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.7" onchange="setVolume()">
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div>
            <div class="vocab-tile" onclick="checkVocab('laws')">LAWS</div>
            <div class="vocab-tile" onclick="checkVocab('love')">LOVE</div>
            <div class="vocab-tile" onclick="checkVocab('holy')">HOLY</div>
            <div class="vocab-tile" onclick="checkVocab('land')">LAND</div>
            <div class="vocab-tile" onclick="checkVocab('help')">HELP</div>
            <div class="vocab-tile" onclick="checkVocab('Lord')">LORD</div>
        </div>
        
        <div class="game-stats">
            <div class="stat-box">Correct: <span id="correctCount">0</span></div>
            <div class="stat-box">Incorrect: <span id="incorrectCount">0</span></div>
        </div>
        
        <div class="feedback" id="vocabFeedback"></div>
        <button class="nav-btn" onclick="hideAllGames()"><i class="fas fa-home"></i> Back to Menu</button>
    </div>

    <script>
        // Vocabulary game state
        const vocabWords = ['laws', 'love', 'holy', 'land', 'help', 'Lord'];
        let currentVocabIndex = 0;
        let vocabAudios = {};
        let isPlaying = false;
        let correctCount = 0;
        let incorrectCount = 0;
        let prepScore = 0;
        let cmdScore = 0;
        let vocabScore = 0;

        // Audio preloading
        const audioFiles = {
            'laws': 'https://ssl.gstatic.com/dictionary/static/sounds/20200429/law--_gb_1.mp3',
            'love': 'https://ssl.gstatic.com/dictionary/static/sounds/20200429/love--_gb_1.mp3',
            'holy': 'https://ssl.gstatic.com/dictionary/static/sounds/20200429/holy--_gb_1.mp3',
            'land': 'https://ssl.gstatic.com/dictionary/static/sounds/20200429/land--_gb_1.mp3',
            'help': 'https://ssl.gstatic.com/dictionary/static/sounds/20200429/help--_gb_1.mp3',
            'Lord': 'https://ssl.gstatic.com/dictionary/static/sounds/20200429/lord--_gb_1.mp3',
            'success': 'https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3',
            'error': 'https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3'
        };

        // Initialize the game
        document.addEventListener('DOMContentLoaded', function() {
            hideAllGames();
            preloadAudio();
            setVolume();
            updateWordInfo();
            updateProgressBar();
        });

        function showGame(gameId) {
            hideAllGames();
            document.getElementById(gameId).style.display = 'block';
            
            if (gameId === 'prepositions') {
                resetPrepositions();
                document.getElementById('prepScore').textContent = prepScore;
            }
            if (gameId === 'commandments') {
                resetCommandments();
                document.getElementById('cmdScore').textContent = cmdScore;
            }
            if (gameId === 'vocabulary') {
                document.getElementById('vocabFeedback').innerHTML = "";
                document.getElementById('vocabScore').textContent = vocabScore;
                document.getElementById('correctCount').textContent = correctCount;
                document.getElementById('incorrectCount').textContent = incorrectCount;
                updateWordInfo();
                updateProgressBar();
            }
        }
        
        function hideAllGames() {
            document.querySelectorAll('.game-container').forEach(el => {
                el.style.display = 'none';
            });
        }
        
        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }
        
        function dropPreposition(ev) {
            ev.preventDefault();
            const prepositionId = ev.dataTransfer.getData("text");
            const blankElement = ev.target;

            if (!blankElement.classList.contains('missing-word')) return;

            blankElement.classList.remove('correct-drop', 'incorrect-drop');
            blankElement.style.color = '#333'; 
            blankElement.style.borderBottom = '3px solid #3a7bd5';

            const prepositionText = document.getElementById(prepositionId).textContent;
            blankElement.textContent = prepositionText;
            blankElement.dataset.droppedPrepositionId = prepositionId; 
        }
        
        function checkPrepositions() {
            const blanks = [
                document.getElementById('prepBlank1'), document.getElementById('prepBlank2'),
                document.getElementById('prepBlank3'), document.getElementById('prepBlank4'),
                document.getElementById('prepBlank5'), document.getElementById('prepBlank6'),
                document.getElementById('prepBlank7'), document.getElementById('prepBlank8'),
                document.getElementById('prepBlank9'), document.getElementById('prepBlank10')
            ];
            let correctCount = 0;
            const blankStatuses = []; 

            blanks.forEach(blank => {
                const droppedPrepositionId = blank.dataset.droppedPrepositionId;
                const correctPreposition = blank.dataset.correct;
                let currentStatus = 'empty';

                if (droppedPrepositionId) {
                    if (document.getElementById(droppedPrepositionId).textContent.toLowerCase() === correctPreposition.toLowerCase()) {
                        currentStatus = 'correct';
                        correctCount++;
                    } else {
                        currentStatus = 'incorrect';
                    }
                }
                blankStatuses.push({element: blank, status: currentStatus});
            });

            const prepFeedback = document.getElementById('prepFeedback');
            if (correctCount === blanks.length) {
                prepFeedback.innerHTML = "Excellent! All prepositions are correct!";
                prepFeedback.className = "feedback correct";
                playSound('success');
            } else if (correctCount > 0) {
                prepFeedback.innerHTML = `You got ${correctCount} out of ${blanks.length} correct. Keep trying!`;
                prepFeedback.className = "feedback incorrect";
                playSound('error');
            } else {
                prepFeedback.innerHTML = "Please fill all the blanks.";
                prepFeedback.className = "feedback incorrect";
                playSound('error');
            }

            prepScore = correctCount;
            document.getElementById('prepScore').textContent = prepScore;

            blankStatuses.forEach(item => {
                item.element.classList.remove('correct-drop', 'incorrect-drop');
                item.element.style.color = ''; 
                item.element.style.borderBottom = ''; 

                if (item.status === 'correct') {
                    item.element.classList.add('correct-drop');
                } else if (item.status === 'incorrect') {
                    item.element.classList.add('incorrect-drop');
                } else { 
                    item.element.style.color = '#333'; 
                    item.element.style.borderBottom = '3px solid #3a7bd5';
                    if (!item.element.dataset.droppedPrepositionId) item.element.textContent = '';
                }
            });
        }

        function resetPrepositions() {
            const blanks = [
                document.getElementById('prepBlank1'), document.getElementById('prepBlank2'),
                document.getElementById('prepBlank3'), document.getElementById('prepBlank4'),
                document.getElementById('prepBlank5'), document.getElementById('prepBlank6'),
                document.getElementById('prepBlank7'), document.getElementById('prepBlank8'),
                document.getElementById('prepBlank9'), document.getElementById('prepBlank10')
            ];
            blanks.forEach(blank => {
                blank.textContent = ''; 
                delete blank.dataset.droppedPrepositionId; 
                blank.classList.remove('correct-drop', 'incorrect-drop');
                blank.style.color = '#333'; 
                blank.style.borderBottom = '3px solid #3a7bd5';
            });
            document.getElementById('prepFeedback').innerHTML = "";
            document.getElementById('prepFeedback').className = "feedback";
        }
        
        function drop(ev) { 
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            draggedElement.classList.remove('correct-placement', 'incorrect-placement');

            let targetBasket = ev.target;
            while(targetBasket && !targetBasket.classList.contains('basket') && targetBasket !== document.body) {
                targetBasket = targetBasket.parentElement;
            }

            if (targetBasket && targetBasket.classList.contains('basket') && draggedElement && draggedElement.classList.contains('commandment-card')) {
                 targetBasket.appendChild(draggedElement);
            } else if (ev.target.id === 'commandmentOptionsContainer' && draggedElement && draggedElement.classList.contains('commandment-card')) {
                 ev.target.appendChild(draggedElement);
            }
        }

        function checkCommandments() {
            const loveGodBasket = document.getElementById('loveGod');
            const lovePeopleBasket = document.getElementById('lovePeople');
            const cmdFeedback = document.getElementById('cmdFeedback');
            const initialCommandmentsContainer = document.getElementById('commandmentOptionsContainer');
            
            let correctCount = 0;
            let unsortedCardsExist = false;
            const cardStatuses = [];

            loveGodBasket.querySelectorAll('.commandment-card').forEach(card => {
                const isCorrect = card.dataset.category === 'loveGod';
                cardStatuses.push({element: card, status: isCorrect ? 'correct' : 'incorrect'});
                if (isCorrect) correctCount++;
            });

            lovePeopleBasket.querySelectorAll('.commandment-card').forEach(card => {
                const isCorrect = card.dataset.category === 'lovePeople';
                cardStatuses.push({element: card, status: isCorrect ? 'correct' : 'incorrect'});
                if (isCorrect) correctCount++;
            });
            
            initialCommandmentsContainer.querySelectorAll('.commandment-card').forEach(card => {
                unsortedCardsExist = true;
                cardStatuses.push({element: card, status: 'unsorted'}); 
            });

            cmdScore = correctCount;
            document.getElementById('cmdScore').textContent = cmdScore;
            
            if (unsortedCardsExist) {
                cmdFeedback.innerHTML = "Don't forget to sort all the commandments!";
                cmdFeedback.className = "feedback incorrect";
                playSound('error');
            } else if (correctCount < 10) {
                cmdFeedback.innerHTML = `You sorted ${correctCount} commandments correctly. Keep trying!`;
                cmdFeedback.className = "feedback incorrect";
                playSound('error');
            } else {
                cmdFeedback.innerHTML = "Great sorting! You know how to love God and love people!";
                cmdFeedback.className = "feedback correct";
                playSound('success');
            }

            cardStatuses.forEach(item => {
                item.element.classList.remove('correct-placement', 'incorrect-placement');
                if (item.status === 'correct') {
                    item.element.classList.add('correct-placement');
                } else if (item.status === 'incorrect') {
                    item.element.classList.add('incorrect-placement');
                }
            });
        }

        function resetCommandments() {
            const loveGodBasket = document.getElementById('loveGod');
            const lovePeopleBasket = document.getElementById('lovePeople');
            const commandmentOptionsContainer = document.getElementById('commandmentOptionsContainer');

            const cardsToMove = [];
            loveGodBasket.querySelectorAll('.commandment-card').forEach(card => cardsToMove.push(card));
            lovePeopleBasket.querySelectorAll('.commandment-card').forEach(card => cardsToMove.push(card));
            
            cardsToMove.forEach(card => {
                card.classList.remove('correct-placement', 'incorrect-placement');
                commandmentOptionsContainer.appendChild(card);
            });
            
            document.getElementById('cmdFeedback').innerHTML = "";
            document.getElementById('cmdFeedback').className = "feedback";
            shuffleChildren(commandmentOptionsContainer);
        }

        function shuffleChildren(parent) {
            let children = Array.from(parent.children);
            let itemsToShuffle = children.filter(child => child.classList.contains('commandment-card'));
            let otherItems = children.filter(child => !child.classList.contains('commandment-card')); 
            
            for (let i = itemsToShuffle.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [itemsToShuffle[i], itemsToShuffle[j]] = [itemsToShuffle[j], itemsToShuffle[i]];
            }
            parent.innerHTML = '';
            otherItems.forEach(child => parent.appendChild(child));
            itemsToShuffle.forEach(child => parent.appendChild(child));
        }
        
        function preloadAudio() {
            for (const [key, url] of Object.entries(audioFiles)) {
                vocabAudios[key] = new Audio(url);
                vocabAudios[key].preload = 'auto';
            }
        }

        function playCurrentWord(force = false) {
            const word = vocabWords[currentVocabIndex];
            if (!vocabAudios[word]) return;
            
            // Only play if not already playing or if forced repeat
            if (!isPlaying || force) {
                isPlaying = true;
                vocabAudios[word].currentTime = 0;
                
                const playPromise = vocabAudios[word].play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        document.getElementById('vocabFeedback').innerHTML = 
                            "Playback failed. Click play again.";
                        document.getElementById('vocabFeedback').className = "feedback incorrect";
                    }).finally(() => {
                        isPlaying = false;
                    });
                }
            }
        }

        function playNextWord() {
            currentVocabIndex = (currentVocabIndex + 1) % vocabWords.length;
            updateWordInfo();
            updateProgressBar();
            playCurrentWord();
        }

        function playPreviousWord() {
            currentVocabIndex = (currentVocabIndex - 1 + vocabWords.length) % vocabWords.length;
            updateWordInfo();
            updateProgressBar();
            playCurrentWord();
        }

        function updateWordInfo() {
            const word = vocabWords[currentVocabIndex];
            const wordInfo = document.getElementById('currentWordInfo');
            wordInfo.textContent = `Word ${currentVocabIndex + 1} of ${vocabWords.length}: ${word.toUpperCase()}`;
        }
        
        function updateProgressBar() {
            const progress = ((currentVocabIndex + 1) / vocabWords.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function checkVocab(word) {
            const vocabFeedback = document.getElementById('vocabFeedback');
            const correctWord = vocabWords[currentVocabIndex];
            
            if (word === correctWord) {
                vocabFeedback.innerHTML = `Correct! ${word.toUpperCase()}!`;
                vocabFeedback.className = "feedback correct";
                playSound('success');
                correctCount++;
                vocabScore++;
                document.getElementById('vocabScore').textContent = vocabScore;
                document.getElementById('correctCount').textContent = correctCount;
                
                // Auto-advance after correct answer
                setTimeout(() => {
                    playNextWord();
                    vocabFeedback.innerHTML = "";
                }, 1500);
            } else {
                vocabFeedback.innerHTML = "Try again! Listen carefully!";
                vocabFeedback.className = "feedback incorrect";
                playSound('error');
                incorrectCount++;
                document.getElementById('incorrectCount').textContent = incorrectCount;
            }
        }

        function playSound(type) {
            if (vocabAudios[type]) {
                vocabAudios[type].currentTime = 0;
                vocabAudios[type].play().catch(e => console.log(`Couldn't play ${type} sound`));
            }
        }

        function setVolume() {
            const volume = document.getElementById('volumeControl').value;
            Object.values(vocabAudios).forEach(audio => {
                audio.volume = volume;
            });
        }
    </script>
</body>
</html>
